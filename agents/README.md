# Claude Code Subagents for Physical AI Textbook

**8 specialized AI assistants** for generating, verifying, and translating textbook content while enforcing [constitution principles](../.specify/memory/constitution.md).

---

## Quick Start (3 Steps)

1. **Identify your task** (e.g., "Generate chapter on ROS 2 Services")
2. **Choose agent** from directory below (e.g., @content-generator)
3. **Use prompt**: `"@content-generator Write chapter on ROS 2 Services with code examples"`

The agent will generate content, enforce constitution principles, and add a footer:
```html
<!-- Generated by @content-generator on 2025-12-06 -->
```

---

## Agent Directory

| Agent | Role | Example Prompt | Constitution Principles |
|-------|------|----------------|------------------------|
| **@content-generator** | Full chapters with MDX, code, diagrams | `"@content-generator Write Module 1 Chapter 3: ROS 2 Pub/Sub"` | II (Spec-First), III (Accuracy), IV (Sim-to-Real) |
| **@reference-finder** | Latest papers, docs, GitHub repos | `"@reference-finder Find VLA papers and NVIDIA Isaac docs"` | III (Accuracy & Technical Truth) |
| **@proofreader** | Grammar, clarity, beginner-friendly | `"@proofreader Check chapter 3 for clarity"` | III (Clarity aspect) |
| **@quiz-generator** | MCQs + coding exercises | `"@quiz-generator Create quiz for ROS 2 chapter"` | II (Educational quality) |
| **@summary-writer** | 3-bullet TL;DR summaries (≤20 words each) | `"@summary-writer Summarize Isaac Sim chapter"` | I (Single Source of Truth) |
| **@hardware-economist** | Verify $249 Jetson, $349 RealSense pricing | `"@hardware-economist Verify Economy Kit pricing"` | V (Cost Transparency) |
| **@sim2real-priest** | Sim-to-real enforcement, latency trap screaming | `"@sim2real-priest Review code for cloud-robot patterns"` | IV (Sim-to-Real), XI (Latency Trap) |
| **@urdu-translator** | Technical Urdu translation | `"@urdu-translator Translate Module 1 intro to Urdu"` | VI (Urdu + Personalization) |

---

## Invocation Pattern

### Basic Invocation

Use `@agent-name` prefix in natural language prompts:

```markdown
"@content-generator Write a chapter on ROS 2 Services with Python code examples, 2000 words"
```

The agent will:
1. Validate spec exists (Principle II)
2. Generate content following its system prompt
3. Self-validate (grammar, constitution compliance, footer)
4. Return complete, ready-to-use content

### With Specific Requirements

```markdown
"@content-generator Write Isaac Sim tutorial with:
- 1500 words
- Include Mermaid diagram of sim-to-real workflow
- Show ONNX export and Jetson deployment
- Target audience: beginners"
```

### Multi-Agent Requests

You can reference multiple agents in one prompt:

```markdown
"Generate ROS 2 chapter with @content-generator,
then @proofreader for grammar,
then @sim2real-priest to validate no cloud-robot control"
```

---

## Agent Chaining (Sequential Workflow)

Combine agents for complete content pipelines:

### Example 1: Complete Chapter Pipeline

```markdown
Step 1: "@content-generator Write chapter on Isaac Sim scene authoring"
  ↓ (generates 2000-word chapter)

Step 2: "@proofreader Check the generated chapter for clarity"
  ↓ (returns improvement suggestions)

Step 3: "@sim2real-priest Validate sim-to-real workflow in the chapter"
  ↓ (APPROVE or REJECT with required fixes)

Step 4: "@summary-writer Create 3-bullet summary"
  ↓ (generates TL;DR for chapter top)
```

**Result**: Publication-ready chapter with verified accuracy, clarity, safety, and summary.

### Example 2: Hardware Chapter Pipeline

```markdown
Step 1: "@reference-finder Find Jetson Orin Nano and RealSense specs"
  ↓ (returns official NVIDIA and Intel documentation)

Step 2: "@hardware-economist Verify current pricing"
  ↓ (generates table: Jetson $249, RealSense $349, Total $700)

Step 3: "@content-generator Write hardware guide using verified specs and pricing"
  ↓ (generates chapter with accurate information)
```

**Result**: Hardware guide with 100% verified pricing and specs.

### Example 3: Assessment Creation

```markdown
Step 1: "@content-generator Write ROS 2 Pub/Sub chapter"
  ↓ (generates teaching chapter)

Step 2: "@quiz-generator Create quiz for the chapter"
  ↓ (generates 5 MCQs + 2 coding exercises)

Step 3: "@summary-writer Summarize the chapter"
  ↓ (generates 3-bullet TL;DR)
```

**Result**: Complete learning module (chapter + assessment + summary).

---

## Constitution Enforcement

Each agent automatically enforces specific [constitution principles](../.specify/memory/constitution.md). Here's how:

### Principle II: Specification-First Development

**Agent**: @content-generator

**Enforcement**: Refuses to generate chapters without approved spec file:

```markdown
Input: "@content-generator Write chapter on advanced VLA models"

Output: "❌ Cannot generate chapter without approved specification.
Required: /specs/module-4-vla/spec.md
Please run /sp.specify first to create the specification."
```

### Principle III: Accuracy & Technical Truth

**Agents**: @content-generator, @reference-finder, @hardware-economist

**Enforcement**:
- @content-generator cites authoritative sources (ros.org, NVIDIA docs, research papers)
- @reference-finder verifies all URLs return HTTP 200
- @hardware-economist checks prices within 30 days, flags stale data

**Example**:
```markdown
Input: "@hardware-economist What does Jetson Orin Nano cost?"

Output: "$249 (verified 2025-12-06 from NVIDIA Store: https://store.nvidia.com)"
```

### Principle IV: Sim-to-Real First Philosophy

**Agents**: @content-generator, @sim2real-priest

**Enforcement**:
- @content-generator always shows "Train in cloud → Export → Deploy to Jetson" workflow
- @sim2real-priest REJECTS any cloud-robot control patterns

**Example**:
```markdown
Input: "@sim2real-priest Review: requests.post(api, robot_cmd)"

Output: "❌ REJECTED: PRINCIPLE IV VIOLATION - LATENCY TRAP
Network call introduces 50-200ms latency → UNSAFE for real robots
REQUIRED: Deploy model to Jetson for local inference (<10ms)"
```

### Principle V: Cost Transparency

**Agent**: @hardware-economist

**Enforcement**: Every hardware mention includes verified price with vendor link

**Example**:
```markdown
Input: "@hardware-economist Generate Economy Jetson Kit table"

Output:
| Component | Price | Vendor | Last Verified |
|-----------|-------|--------|---------------|
| Jetson Orin Nano | $249 | NVIDIA Store | 2025-12-06 |
| RealSense D435i | $349 | Intel Store | 2025-12-06 |
| Accessories | $100 | Amazon | 2025-12-06 |
| **Total** | **$700** | - | - |
```

### Principle VI: Urdu + Personalization Ready

**Agent**: @urdu-translator

**Enforcement**: Generates natural Urdu while preserving technical terms

**Example**:
```markdown
Input: "@urdu-translator Translate 'ROS 2 is middleware' to Urdu"

Output: "ROS 2 (روبوٹک آپریٹنگ سسٹم 2) مڈل ویئر ہے جو روبوٹ کے اجزاء کو جوڑتا ہے۔"
```

### Principle XI: Latency Trap Rule

**Agent**: @sim2real-priest

**Enforcement**: Adds required warning for any cloud communication:

```markdown
⚠️ **LATENCY TRAP WARNING** ⚠️

This architecture sends commands over the network.
Network latency (50-200ms+) makes this UNSAFE for real robots.

Use this pattern ONLY for:
- Simulation environments (Isaac Sim, Gazebo)
- High-level planning (not real-time control)
- Data collection (not actuation)

For real robots: Deploy models to edge devices (Jetson) for <10ms inference.
```

---

## Output Validation

All agents add a footer for traceability:

```html
<!-- Generated by @agent-name on YYYY-MM-DD -->
```

### Validation Checklist

Before using agent-generated content, verify:

- [ ] **Footer present**: `<!-- Generated by @agent-name on YYYY-MM-DD -->`
- [ ] **Docusaurus build**: Run `npm run build` in `frontend/` (should succeed with 0 errors)
- [ ] **Constitution compliance**:
  - @hardware-economist: Prices verified ≤30 days ago
  - @sim2real-priest: No cloud-robot control patterns
  - @content-generator: Valid MDX syntax, no broken links
- [ ] **Quality checks**:
  - @content-generator: Word count in range, 1+ code example, 1+ diagram
  - @quiz-generator: Exactly 5 MCQs + 2 exercises, answers in collapsible section
  - @summary-writer: Exactly 3 bullets, each ≤20 words

### Manual Validation Steps

1. **Read generated content**: Spot-check technical accuracy
2. **Run Docusaurus build**: `cd frontend && npm run build`
3. **Check footer**: Verify agent name and date match
4. **Test links**: Ensure vendor links return HTTP 200
5. **Human SME review** (especially for @urdu-translator): Native speaker verification

---

## Troubleshooting

### Issue: Agent generates content without footer

**Cause**: Agent skill file doesn't include footer in output format

**Solution**: Verify agent skill file at `/agents/skills/<agent-name>.md` includes footer requirement. Regenerate content.

---

### Issue: @hardware-economist returns outdated prices

**Cause**: Prices change over time (especially during promotions)

**Solution**: Prices are verified within 30 days. If >30 days old, re-run agent:
```markdown
"@hardware-economist Re-verify Economy Jetson Kit pricing as of today"
```

---

### Issue: @sim2real-priest rejects valid code

**Cause**: Code may not explicitly show sim-to-real workflow

**Solution**: Ensure code includes:
1. Comment showing training location (cloud/workstation)
2. Explicit export step (ONNX/TensorRT)
3. Deployment to Jetson mentioned
4. Local inference code (no network calls in control loop)

**Example fix**:
```python
# 1. Train in cloud (AWS g5.xlarge)
# 2. Export to ONNX
model.export('policy.onnx')

# 3. Deploy to Jetson
# scp policy.onnx jetson@robot:/models/

# 4. Run inference locally on Jetson
import onnxruntime as ort
session = ort.InferenceSession('policy.onnx')
action = session.run(None, {'obs': observation})[0]  # <10ms
```

---

### Issue: @proofreader suggests changing technical terms

**Cause**: Agent may misidentify proper nouns as jargon

**Solution**: Technical terms like "ROS 2", "Jetson", "URDF" should never be changed. If agent suggests changes, override with:
```markdown
"@proofreader: This term is a proper noun, keep as-is"
```

Or add comment in source: `<!-- @proofreader: jargon approved -->`

---

### Issue: @urdu-translator produces gibberish

**Cause**: Machine translation without context

**Solution**: This agent generates natural Urdu. If output is unclear:
1. Request native Urdu speaker review (Constitution requires human validation for Urdu)
2. Provide more context in prompt:
```markdown
"@urdu-translator Translate this paragraph to Urdu.
Context: This is for beginners learning robotics.
Use simple Urdu, not overly formal language."
```

---

### Issue: Docusaurus build fails after using @content-generator

**Cause**: Invalid MDX syntax (unclosed code fence, broken JSX, etc.)

**Solution**:
1. Check error message: `npm run build` shows exact line number
2. Common fixes:
   - Close all code fences: ` ``` `
   - Escape curly braces in text: `\{` instead of `{`
   - Check frontmatter YAML syntax (colons, quotes)
3. Re-run agent with fix request:
```markdown
"@content-generator Fix MDX syntax error at line 47 (unclosed code fence)"
```

---

### Issue: @quiz-generator creates questions not in chapter

**Cause**: Agent may hallucinate content not covered

**Solution**: Agent is constrained to chapter content only. If questions are off-topic:
```markdown
"@quiz-generator Create quiz ONLY from topics covered in Module 1 Chapter 3.
Do not include advanced topics from later chapters."
```

---

## Future Enhancements

### Planned Features

1. **MCP (Model Context Protocol) Servers**
   - Convert agents to MCP servers for programmatic invocation
   - Enable structured tool calls with JSON input/output
   - Support agent chaining via MCP composability

2. **Slash Commands**
   - Integrate agents as Claude Code slash commands
   - Example: `/content-generator "topic"` instead of prompt prefix
   - Benefits: Better IDE integration, command history

3. **Automated Validation**
   - CI/CD checks for agent footer presence
   - Automated Docusaurus build tests on PRs
   - Price staleness detection (flag prices >30 days old)
   - Constitution violation scanner (detect cloud-robot patterns automatically)

4. **Agent Metrics Dashboard**
   - Track agent usage (which agents are most used?)
   - Measure output quality (how often is content accepted vs. revised?)
   - Cost monitoring (API calls per agent per month)

5. **Additional Agents**
   - **@diagram-artist**: Generate Mermaid diagrams from descriptions
   - **@code-reviewer**: Review code examples for bugs, style, security
   - **@latex-renderer**: Convert math equations to LaTeX for MDX
   - **@accessibility-checker**: Ensure content meets WCAG 2.1 guidelines

---

## Contributing

### Adding New Agents

To create a new agent:

1. **Create bio file**: `/agents/<new-agent-name>.md`
   - Follow template from existing agents
   - Include: Role, Expertise, Constitution Principles, Input/Output Format, Examples

2. **Create skill file**: `/agents/skills/<new-agent-name>.md`
   - Minimum 500 words
   - Include: System Prompt, Mission, Capabilities, Constraints, Constitution Enforcement, Quality Checks, Examples

3. **Update this README**: Add agent to directory table and examples

4. **Test agent**: Generate sample output, validate against constitution

5. **Submit PR**: Include agent files + sample output + test results

### Modifying Existing Agents

To update an agent's behavior:

1. Edit skill file: `/agents/skills/<agent-name>.md`
2. Update system prompt, capabilities, or constraints
3. Increment version number at bottom of skill file
4. Test with 3+ sample prompts to verify changes
5. Update bio file if input/output format changes
6. Submit PR with changes + rationale + test results

---

## Additional Resources

- **Constitution**: [`.specify/memory/constitution.md`](../.specify/memory/constitution.md) - Immutable principles all agents enforce
- **Spec Template**: [`.specify/templates/spec-template.md`](../.specify/templates/spec-template.md) - How to create specifications
- **Agent Bios**: [`/agents/`](/agents/) - Individual agent descriptions
- **Agent Skills**: [`/agents/skills/`](/agents/skills/) - Detailed system prompts (500+ words each)
- **Task List**: [`specs/003-claude-code-subagents/tasks.md`](../specs/003-claude-code-subagents/tasks.md) - Implementation plan (22 tasks)
- **Plan**: [`specs/003-claude-code-subagents/plan.md`](../specs/003-claude-code-subagents/plan.md) - Architecture and design decisions

---

## Support

- **Agent Issues**: If an agent produces incorrect output, check skill file for constraints and examples
- **Constitution Violations**: Report to project maintainers (agents should self-enforce, but manual review catches edge cases)
- **Feature Requests**: Open issue with `[agents]` tag to propose new agents or enhancements

---

**Last Updated**: 2025-12-06
**Agents Version**: 1.0
**Total Agents**: 8
**Total Bio Word Count**: ~3,000 words
**Total Skill Word Count**: ~7,900 words
**Constitution Principles Enforced**: 7 of 11 (I, II, III, IV, V, VI, IX, XI)
